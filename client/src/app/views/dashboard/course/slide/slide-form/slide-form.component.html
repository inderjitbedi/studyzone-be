<div fxLayout="column" class="container-div">

    <mat-toolbar class="mat-accent-bg m-0" fxLayoutAlign="end flex-end">
        <div fxFlex="100" fxLayout="row" fxLayoutAlign="space-between flex-end" class="mat-toolbar-header">
            <span class="title dialog-title">{{slideId?'Edit':'Create'}} Slide</span>
            <button class="mat-icon-button mat-button" aria-label="Close dialog" mat-button (click)="matDialog.close()">
                <span class="mat-button-wrapper">
                    <mat-icon class="mat-icon material-icons" role="img" aria-hidden="true">close</mat-icon>
                </span>
            </button>
        </div>
    </mat-toolbar>
    <mat-divider class="mt-10"></mat-divider>
    <div class="content p-20 mt-20" fxLayout="column">
        <form [formGroup]="slideForm" fx-layout="column">
            <div fxLayout="column" fxLayout.gt-xs="row" [class.form-div]="!isViewOnly" [class.mt-30]="isViewOnly">
                <div fxLayout="column" fxLayout.gt-xs="row">
                    <mat-form-field
                        [class.mb-10]="slideForm.controls['name'].touched && slideForm.controls['name'].hasError('required')"
                        fxFlex="100">
                        <mat-label>Slide Name
                        </mat-label>
                        <input type="text" matInput formControlName="name" trim autocomplete="off"
                            [errorStateMatcher]="matcher" maxlength="50" [readonly]="isViewOnly">
                        <mat-error *ngIf="slideForm.controls['name'].hasError('required')">Required
                        </mat-error>
                        <mat-error
                            *ngIf="!slideForm.controls['name'].hasError('required') && !slideForm.controls['name'].hasError('pattern') && slideForm.controls['name'].hasError('not_unique')">
                            Slide name already exists.
                        </mat-error>
                        <mat-error
                            *ngIf="!slideForm.controls['name'].hasError('required') && slideForm.controls['name'].hasError('pattern')">
                            Slide name can only be alpha-numeric.
                        </mat-error>
                        <mat-hint align="end" *ngIf="!isViewOnly">{{nameMaxLength -
                            slideForm.controls['name'].value.length}}
                            {{nameMaxLength -
                            slideForm.controls['name'].value.length>1?'characters':'character'}}
                            left.</mat-hint>
                    </mat-form-field>
                </div>
                <div fxLayout="column" fxLayout.gt-xs="row">
                    <mat-form-field>
                        <mat-label>Type</mat-label>
                        <mat-select formControlName="type">
                            <mat-option *ngFor="let type of types" [value]="type">
                                {{type | titlecase}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <!-- <div fxLayout="column" fxLayout.gt-xs="row">
                    <mat-checkbox formControlName="isPublished">
                        Publish now
                    </mat-checkbox>
                </div> -->

                <div fxLayout="column" fxLayout.gt-xs="row" class="uploadImage"
                    *ngIf="(selectedType == 'video' || selectedType == 'audio'|| selectedType == 'pdf') && !isViewOnly">
                    <mat-label>{{selectedFileSettings.name|titlecase }} *
                        <mat-icon
                            matTooltip="Please select an {{selectedFileSettings.name}}. Max size: {{selectedFileSettings.maxSize}}MB"
                            [matTooltipPosition]="'after'" class="mat-icon material-icons info" role="img"
                            aria-hidden="true">
                            info
                        </mat-icon>
                    </mat-label>
                    <div id="file-upload-form" class="uploader">
                        <input id="file-upload" type="file" name="fileUpload" accept="{{selectedFileSettings.mimeType}}"
                            (change)="uploadFiles($event)" />
                        <label for="file-upload" id="file-drag">
                            <div id="start"
                                *ngIf="!uploadingInProgess && (!attachment && !slideForm.controls[selectedFileSettings.key]?.value)">
                                <i class="fa fa-download" aria-hidden="true"></i>
                                <div></div>
                                <div id="notimage">Please select an {{selectedFileSettings.name}}. Max size:
                                    {{selectedFileSettings.maxSize}}MB</div>
                                <span id="file-upload-btn" class="btn btn-primary">Select a file</span>
                            </div>
                            <div id="start"
                                *ngIf="!uploadingInProgess &&  (attachment || slideForm.controls[selectedFileSettings.key]?.value)">
                                <span id="file-upload-btn" class="btn btn-primary">Select another</span>
                            </div>
                            <div id="response" *ngIf="uploadingInProgess">
                                <div id="messages">Uploading... {{uploadingProgress ?
                                    (uploadingProgress- 1)+'%' : '0%' }}</div>
                                <progress class="progress" value="{{uploadingProgress}}" max="100">
                                </progress>
                            </div>
                        </label>
                    </div>
                    <div *ngIf="!attachment && !slideForm.controls[selectedFileSettings.key]?.value">
                        <mat-error *ngIf="slideForm.controls[selectedFileSettings.key]?.hasError('required')">Required
                        </mat-error>
                        <mat-error *ngIf="!slideForm.controls[selectedFileSettings.key]?.hasError('required') 
                        && slideForm.controls[selectedFileSettings.key]?.hasError('file_type')">
                            Choose a certain type of file.
                        </mat-error>
                        <mat-error *ngIf="!slideForm.controls[selectedFileSettings.key]?.hasError('required')
                        && !slideForm.controls[selectedFileSettings.key]?.hasError('file_type') 
                        && slideForm.controls[selectedFileSettings.key]?.hasError('file_size')">
                            File size should not be greater than {{selectedFileSettings.maxSize}}MB.
                        </mat-error>
                    </div>
                </div>
                <video controls
                    *ngIf="(!uploadingInProgess &&  (attachment || slideForm.controls[selectedFileSettings.key]?.value) && selectedType == 'video') || (isViewOnly && selectedSlideDetails.type == 'video')"
                    src="{{slideForm.controls['file'].value? environment.baseUrl + slideForm.controls['file'].value:''}}"
                    width="100%">
                    Sorry, your browser doesn't support embedded videos.
                </video>
                <div style="text-align: center;width: 100%;"
                    *ngIf="(!uploadingInProgess &&  (attachment || slideForm.controls[selectedFileSettings.key]?.value) && selectedType == 'audio') || (isViewOnly && selectedSlideDetails.type == 'audio')">
                    <audio controls>
                        <source
                            src="{{slideForm.controls['file'].value? environment.baseUrl + slideForm.controls['file'].value:''}}">
                        Sorry, your browser does not support the audio element.
                    </audio>
                </div>
                <div style="text-align: center;width: 100%;"
                    *ngIf="(!uploadingInProgess &&  (attachment || slideForm.controls[selectedFileSettings.key]?.value) && selectedType == 'pdf') || (isViewOnly && selectedSlideDetails.type == 'pdf')">
                    <p><span *ngIf="attachment.originalName" class="material-icons">picture_as_pdf</span>  {{attachment.originalName||'No file found'}}</p>
                </div>
                <div fxLayout="column" fxLayout.gt-xs="row"
                    *ngIf="selectedType == 'text'|| (isViewOnly && selectedSlideDetails.type == 'text')">
                    <mat-form-field class="mb-10" fxFlex="100">
                        <mat-label>Text
                        </mat-label>
                        <textarea matInput formControlName="text" trim autocomplete="off" [errorStateMatcher]="matcher"
                            [rows]="isViewOnly?15:10" [readonly]="isViewOnly"></textarea>
                        <!-- maxlength="2500"
                            <mat-hint align="end" *ngIf="!isViewOnly">{{textMaxLength -
                            slideForm.controls['text'].value.length}}
                            {{textMaxLength -
                            slideForm.controls['text'].value.length>1?'characters':'character'}}
                            left.</mat-hint> -->
                        <mat-error *ngIf="slideForm.controls['text'].hasError('required')">Required
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>
        </form>
    </div>
    <mat-toolbar class="mat-accent-bg m-0 mt-12" fxLayoutAlign="center" *ngIf="!isViewOnly">
        <div fxlayout="row" fxLayoutAlign="flex-end" class="mt-12" fxFlex="100"
            class="mat-toolbar-footer action-buttons">
            <button type="submit" mat-raised-button color="primary" [disabled]="slideForm.invalid || apiCallActive"
                (click)="saveSlide()">Save</button>
            <button type="button" mat-raised-button class="mr-20" (click)="matDialog.close()">Cancel</button>
        </div>
    </mat-toolbar>
</div>